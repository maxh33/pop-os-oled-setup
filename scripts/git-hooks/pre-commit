#!/bin/bash
# Global pre-commit hook - runs gemini-git-helper.sh in pre-commit mode
# Enabled via: git config --global core.hooksPath /home/max/bin/git-hooks/

# Run fast secrets-only scan
if command -v gemini-git-helper.sh &> /dev/null; then
    # Use --pre-commit flag for fast, quiet operation
    output=$(gemini-git-helper.sh --pre-commit 2>&1)
    exit_code=$?

    if [ $exit_code -ne 0 ]; then
        echo ""
        echo -e "\033[0;31m========================================\033[0m"
        echo -e "\033[0;31m  COMMIT BLOCKED: Secrets detected!\033[0m"
        echo -e "\033[0;31m========================================\033[0m"
        echo ""
        echo "$output" | grep -E "(SENSITIVE|Found in|Line [0-9]+:)"
        echo ""
        echo "Fix the issues above before committing."
        echo "To bypass (NOT recommended): git commit --no-verify"
        exit 1
    fi

    echo -e "\033[0;32mâœ“\033[0m No secrets detected"
else
    echo "Warning: gemini-git-helper.sh not found in PATH"
fi

exit 0
